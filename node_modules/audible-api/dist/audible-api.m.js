function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t){(t.exports=function(){this.clear()}).prototype={put:function(t,e){void 0===this.__store[t]&&this.__size++;this.__store[t]=e},get:function(t){return this.__store[t]},remove:function(t){void 0!==this.__store[t]&&this.__size--;delete this.__store[t]},clear:function(){this.__size=0,this.__store={}},size:function(){return this.__size},keys:function(){return e(this.__store)}};var e=Object.keys||function(t){if("object"!=typeof t&&("function"!=typeof t||null===t))throw new TypeError("Object.keys called on non-object");var e=[];for(var o in t)e.hasOwnProperty.call(t,o)&&e.push(o);return e}}),o={default:e,__moduleExports:e},n=o&&e||o,r=t(function(t){var e=t.exports={},o={};e.create=function(t){return o[t]=new n,o[t]},e.get=function(t){return o[t]},e.remove=function(t){delete o[t]},e.clear=function(){o={}}}),i={default:r,__moduleExports:r},s=i&&r||i,u={stable:"1.0",dev:"0.0"},a={US:"https://api.audible.com",UK:"https://api.audible.co.uk",FR:"https://api.audible.fr",DE:"https://api.audible.de",JP:"https://api.audible.co.jp",IT:"https://api.audible.it",AU:"https://api.audible.com.au"},c={GET:"get",POST:"post",PUT:"put",DELETE:"delete"},p=function(t,e,o){this.cache=s.create(e),this.market=o&&o.market?o.market:a.US,this.version=o&&o.version?o.version:u.stable,this.env=this.market+"/"+this.version+"/",this.cToken=e,this.appID=t,this.debug=!1,this.timeout=o?o.timeout:3e3,this.caching=!0,this.default={verb:c.GET}},h={customerToken:{configurable:!0},Environment:{configurable:!0},applicationID:{configurable:!0}};p.prototype.refreshEnv=function(){this.env=this.market+"/"+this.version+"/"},p.prototype._retrieveMarket=function(){return this.market},p.prototype._retrieveVersion=function(){return this.version},h.customerToken.get=function(){return this.cToken},h.Environment.get=function(){return this.env},h.applicationID.get=function(){return this.appID},p.prototype.isCaching=function(){return this.caching},p.prototype.buildMyResponse=function(t){return t.then(function(t){return t.json().then(function(e){return Object.assign({data:e},t)})})},p.prototype.request=function(t,e,o,n,r,i){var s=this,u={},a=new URL(r&&r.url||this.env+t);e&&(e=e instanceof Array?e.join(","):e,u={response_groups:e}),r&&r.params&&Object.assign(u,r.params),Object.keys(u).forEach(function(t){return a.searchParams.append(t,u[t])});var c={method:o||this.default.verb,timeout:this.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"}};if(n&&(Object.assign(c.headers,this.authenticate()),c.credentials="include"),r&&(c=Object.assign(c,r)),this.log("Options Requested:",c),!this.isCaching()||!0===i)return this.buildMyResponse(fetch(a,c));var p,h=JSON.stringify(c),l=this.cache.get(h);return void 0===l?((p=this.buildMyResponse(fetch(a,c))).then(function(t){200===t.status&&s.cache.put(h,p)}),p):l},p.prototype.authenticate=function(){if(!this.appID)throw"PublicKey and Customer ID required.";var t={"Client-ID":this.appID};return this.cToken&&(t.Authorization="bearer "+this.cToken),t},p.prototype.log=function(){this.debug&&console.log.apply(console,arguments)},Object.defineProperties(p.prototype,h);export default function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getPage=function(t,e,o){return this.request("pages/"+t,e,c.GET,!0,o)},e.prototype.getCategories=function(t,e){return this.request("catalog/categories",t,c.GET,!0,e)},e.prototype.getChannels=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=null);return this.request("catalog/categories",t,c.GET,!0,Object.assign(e,{params:{root:"ShortsCurated",categories_num_levels:2}}),o)},e.prototype.getCategory=function(t,e,o){return void 0===o&&(o={}),this.request("catalog/categories/"+t,e,c.GET,!0,o)},e.prototype.getProduct=function(t,e,o){return this.request("catalog/products/"+t,e,c.GET,!0,o)},e.prototype.searchProducts=function(t,e,o){return void 0===o&&(o={}),this.request("catalog/products",e,c.GET,!0,Object.assign({params:t},o))},e.prototype.getProductReviews=function(t,e,o,n){return this.request("catalog/products/"+t+"/reviews",e,c.GET,!0,o,n)},e.prototype.getLibraryBooks=function(t,e,o){return this.request(null,null,c.GET,!0,{url:this._retrieveMarket()+"/"+u.dev+"/library/books",timeout:o||9500,params:{purchaseAfterDate:t,sortInAscendingOrder:"true",response_groups:"media"}},e)},e.prototype.getProductStream=function(t,e,o,n){return void 0===n&&(n={}),this.request("content/"+t+"/licenserequest",null,c.POST,!0,{body:JSON.stringify(Object.assign(n,{consumption_type:o||"Streaming",drm_type:e||"Hls"}))},!0)},e.prototype.putProductLastPosition=function(t,e,o,n){return void 0===n&&(n={}),this.request("lastpositions/"+t,null,c.PUT,!0,Object.assign(n,{data:{acr:e,asin:t,position_ms:o}}))},e.prototype.getProductLastPosition=function(t,e,o){return void 0===o&&(o={}),this.request("lastpositions/"+t,null,c.GET,!0,Object.assign(o,{params:{acr:e}}),!0)},e.prototype.getProductsLastPosition=function(t,e){return void 0===e&&(e={}),this.request("annotations/lastpositions?asins="+t,null,c.GET,!0,e,!0)},e.prototype.getProductMetadata=function(t,e,o){return this.request("content/"+t+"/metadata",e,c.GET,!0,o,!0)},e.prototype.getProductRecomendations=function(t,e,o){return void 0===o&&(o={}),this.request("recommendations",t,c.GET,!0,Object.assign({params:{num_results:e}},o),!0)},e.prototype.getSimilarProducts=function(t,e,o,n){return this.request("catalog/products/"+t+"/sims",e,c.GET,!0,o,n)},e.prototype.postListeningEvent=function(t,e,o,n,r,i,s,u,a,p,h,l,d){return void 0===i&&(i=72e7),void 0===s&&(s="America/New_York"),void 0===u&&(u="Listening"),void 0===a&&(a=!0),void 0===p&&(p="Audible"),void 0===h&&(h="Online"),void 0===l&&(l=1),this.request("stats/events",null,c.PUT,!0,Object.assign({data:JSON.stringify({stats:[{asin:t,asin_owned:a,event_timestamp:e,event_end_timestamp:o,event_start_position:n,event_end_position:r,event_type:u,local_timezone:s,store:p,listening_mode:h,narration_speed:l,length_of_book:i}]})},d),!0)},e.prototype.getRequest=function(t,e,o,n,r){return this.request(t,e,c.GET,n,o,r)},e.prototype.getUserProfile=function(){return this.request("",null,c.GET,!0,{url:"https://api.amazon.com/user/profile"})},e}(p);export{c as VERB,u as VERSION,a as MARKETS};
//# sourceMappingURL=audible-api.m.js.map
