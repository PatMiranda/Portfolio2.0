function t(t,e){return t(e={exports:{}},e.exports),e.exports}var e=t(function(t){(t.exports=function(){this.clear()}).prototype={put:function(t,e){void 0===this.__store[t]&&this.__size++;this.__store[t]=e},get:function(t){return this.__store[t]},remove:function(t){void 0!==this.__store[t]&&this.__size--;delete this.__store[t]},clear:function(){this.__size=0,this.__store={}},size:function(){return this.__size},keys:function(){return e(this.__store)}};var e=Object.keys||function(t){if("object"!=typeof t&&("function"!=typeof t||null===t))throw new TypeError("Object.keys called on non-object");var e=[];for(var o in t)e.hasOwnProperty.call(t,o)&&e.push(o);return e}}),o=t(function(t){var o=t.exports={},n={};o.create=function(t){return n[t]=new e,n[t]},o.get=function(t){return n[t]},o.remove=function(t){delete n[t]},o.clear=function(){n={}}}),n="1.0",r="0.0",i="https://api.audible.com",s="get",u="post",a="put",c=function(t,e,r){this.cache=o.create(e),this.market=r&&r.market?r.market:i,this.version=r&&r.version?r.version:n,this.env=this.market+"/"+this.version+"/",this.cToken=e,this.appID=t,this.debug=!1,this.timeout=r?r.timeout:3e3,this.caching=!0,this.default={verb:s}},p={customerToken:{configurable:!0},Environment:{configurable:!0},applicationID:{configurable:!0}};c.prototype.refreshEnv=function(){this.env=this.market+"/"+this.version+"/"},c.prototype._retrieveMarket=function(){return this.market},c.prototype._retrieveVersion=function(){return this.version},p.customerToken.get=function(){return this.cToken},p.Environment.get=function(){return this.env},p.applicationID.get=function(){return this.appID},c.prototype.isCaching=function(){return this.caching},c.prototype.buildMyResponse=function(t){return t.then(function(t){return t.json().then(function(e){return Object.assign({data:e},t)})})},c.prototype.request=function(t,e,o,n,r,i){var s=this,u={},a=new URL(r&&r.url||this.env+t);e&&(e=e instanceof Array?e.join(","):e,u={response_groups:e}),r&&r.params&&Object.assign(u,r.params),Object.keys(u).forEach(function(t){return a.searchParams.append(t,u[t])});var c={method:o||this.default.verb,timeout:this.timeout,headers:{"Content-Type":"application/json",Accept:"application/json"}};if(n&&(Object.assign(c.headers,this.authenticate()),c.credentials="include"),r&&(c=Object.assign(c,r)),this.log("Options Requested:",c),!this.isCaching()||!0===i)return this.buildMyResponse(fetch(a,c));var p,h=JSON.stringify(c),l=this.cache.get(h);return void 0===l?((p=this.buildMyResponse(fetch(a,c))).then(function(t){200===t.status&&s.cache.put(h,p)}),p):l},c.prototype.authenticate=function(){if(!this.appID)throw"PublicKey and Customer ID required.";var t={"Client-ID":this.appID};return this.cToken&&(t.Authorization="bearer "+this.cToken),t},c.prototype.log=function(){this.debug&&console.log.apply(console,arguments)},Object.defineProperties(c.prototype,p);var h=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getPage=function(t,e,o){return this.request("pages/"+t,e,s,!0,o)},e.prototype.getCategories=function(t,e){return this.request("catalog/categories",t,s,!0,e)},e.prototype.getChannels=function(t,e,o){void 0===e&&(e={}),void 0===o&&(o=null);return this.request("catalog/categories",t,s,!0,Object.assign(e,{params:{root:"ShortsCurated",categories_num_levels:2}}),o)},e.prototype.getCategory=function(t,e,o){return void 0===o&&(o={}),this.request("catalog/categories/"+t,e,s,!0,o)},e.prototype.getProduct=function(t,e,o){return this.request("catalog/products/"+t,e,s,!0,o)},e.prototype.searchProducts=function(t,e,o){return void 0===o&&(o={}),this.request("catalog/products",e,s,!0,Object.assign({params:t},o))},e.prototype.getProductReviews=function(t,e,o,n){return this.request("catalog/products/"+t+"/reviews",e,s,!0,o,n)},e.prototype.getLibraryBooks=function(t,e,o){return this.request(null,null,s,!0,{url:this._retrieveMarket()+"/"+r+"/library/books",timeout:o||9500,params:{purchaseAfterDate:t,sortInAscendingOrder:"true",response_groups:"media"}},e)},e.prototype.getProductStream=function(t,e,o,n){return void 0===n&&(n={}),this.request("content/"+t+"/licenserequest",null,u,!0,{body:JSON.stringify(Object.assign(n,{consumption_type:o||"Streaming",drm_type:e||"Hls"}))},!0)},e.prototype.putProductLastPosition=function(t,e,o,n){return void 0===n&&(n={}),this.request("lastpositions/"+t,null,a,!0,Object.assign(n,{data:{acr:e,asin:t,position_ms:o}}))},e.prototype.getProductLastPosition=function(t,e,o){return void 0===o&&(o={}),this.request("lastpositions/"+t,null,s,!0,Object.assign(o,{params:{acr:e}}),!0)},e.prototype.getProductsLastPosition=function(t,e){return void 0===e&&(e={}),this.request("annotations/lastpositions?asins="+t,null,s,!0,e,!0)},e.prototype.getProductMetadata=function(t,e,o){return this.request("content/"+t+"/metadata",e,s,!0,o,!0)},e.prototype.getProductRecomendations=function(t,e,o){return void 0===o&&(o={}),this.request("recommendations",t,s,!0,Object.assign({params:{num_results:e}},o),!0)},e.prototype.getSimilarProducts=function(t,e,o,n){return this.request("catalog/products/"+t+"/sims",e,s,!0,o,n)},e.prototype.postListeningEvent=function(t,e,o,n,r,i,s,u,c,p,h,l,f){return void 0===i&&(i=72e7),void 0===s&&(s="America/New_York"),void 0===u&&(u="Listening"),void 0===c&&(c=!0),void 0===p&&(p="Audible"),void 0===h&&(h="Online"),void 0===l&&(l=1),this.request("stats/events",null,a,!0,Object.assign({data:JSON.stringify({stats:[{asin:t,asin_owned:c,event_timestamp:e,event_end_timestamp:o,event_start_position:n,event_end_position:r,event_type:u,local_timezone:s,store:p,listening_mode:h,narration_speed:l,length_of_book:i}]})},f),!0)},e.prototype.getRequest=function(t,e,o,n,r){return this.request(t,e,s,n,o,r)},e.prototype.getUserProfile=function(){return this.request("",null,s,!0,{url:"https://api.amazon.com/user/profile"})},e}(c);module.exports=h;
//# sourceMappingURL=audible-api.js.map
